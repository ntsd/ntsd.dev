<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" name="google-site-verification"><meta content="width=device-width,initial-scale=1" name="viewport"><meta name="keywords" content="Programming, Web Development, Coding, Artificial Intelligence, Machine Learning, Jirawat Boonkumnerd"><meta name="theme-color" content="#000000"><meta content="script-src 'self' 'unsafe-inline' giscus.app *.jsdelivr.net *.googletagmanager.com *.google-analytics.com; object-src 'none';base-uri 'none';" http-equiv="Content-Security-Policy"><title>Explain index types in PostgreSQL | Jirawat Boonkumnerd</title><meta name="generator" content="Jekyll v4.2.1"><meta property="og:title" content="Explain index types in PostgreSQL"><meta name="author" content="ntsd"><meta property="og:locale" content="en_US"><meta name="description" content="Postgres provides many index types such as B-tree, hash, GiST, and GIN. This article is about commons indexes like B-Tree and Hash to tell what is difference and which one should use for the situation. GiST and GIN are indexes for supporting Full-Text Search which I’ll explain in the new blog post."><meta property="og:description" content="Postgres provides many index types such as B-tree, hash, GiST, and GIN. This article is about commons indexes like B-Tree and Hash to tell what is difference and which one should use for the situation. GiST and GIN are indexes for supporting Full-Text Search which I’ll explain in the new blog post."><link rel="canonical" href="https://ntsd.dev/postgresql-index-types/"><meta property="og:url" content="https://ntsd.dev/postgresql-index-types/"><meta property="og:site_name" content="Jirawat Boonkumnerd"><meta property="og:image" content="https://ntsd.dev/pwa/icons/icon-min.svg"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-07-10T00:00:00+07:00"><meta name="twitter:card" content="summary"><meta property="twitter:image" content="https://ntsd.dev/pwa/icons/icon-min.svg"><meta property="twitter:title" content="Explain index types in PostgreSQL"><meta name="twitter:site" content="@ntsd_me"><meta name="twitter:creator" content="@ntsd"><meta property="fb:admins" content="jo.ntsd"><meta property="article:publisher" content="ntsd.dev"><meta property="fb:app_id" content="523337598616322"><script type="application/ld+json">{"mainEntityOfPage":{"@type":"WebPage","@id":"https://ntsd.dev/postgresql-index-types/"},"@type":"BlogPosting","url":"https://ntsd.dev/postgresql-index-types/","image":"https://ntsd.dev/pwa/icons/icon-min.svg","author":{"@type":"Person","name":"ntsd"},"headline":"Explain index types in PostgreSQL","dateModified":"2021-07-10T00:00:00+07:00","datePublished":"2021-07-10T00:00:00+07:00","description":"Postgres provides many index types such as B-tree, hash, GiST, and GIN. This article is about commons indexes like B-Tree and Hash to tell what is difference and which one should use for the situation. GiST and GIN are indexes for supporting Full-Text Search which I’ll explain in the new blog post.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ntsd.dev/pwa/icons/icon-min.svg"},"name":"ntsd"},"@context":"https://schema.org"}</script><link href="https://cdn.jsdelivr.net" rel="preconnect"><style class="anchorjs"></style><link rel="stylesheet" href="/assets/css/style.css"><link rel="manifest" href="/pwa/manifest.json" async=""><link rel="shortcut icon" href="/pwa/icons/icon-min.svg" async=""><link rel="apple-touch-icon" href="/pwa/icons/icon-min.svg" async=""><script>function async(u, c, t, p) { function l() { var d = document, s = "script", o = d.createElement(s), e = d.getElementsByTagName(s)[0]; o.src = u; o.async = true; if (p) { o.setAttribute("data-post-js", true); } if (c) { o.addEventListener( "load", function (e) { c(e); }, false ); } e.parentNode.insertBefore(o, e); } if (t) { setTimeout(l, t); } else { l(); } }</script></head><body><nav class="bg-white shadow sticky top-0 z-50 transition-transform duration-300 transform" id="navbar"><div class="container mx-auto px-6 py-4 lg:flex lg:justify-between lg:items-center"><div class="lg:flex lg:items-center"><div class="flex items-center justify-between"><div><a class="text-2xl font-bold text-gray-800 lg:text-3xl hover:text-gray-700" href="/">Jirawat Boonkumnerd</a></div><div class="flex lg:hidden"><button aria-label="toggle menu" class="text-gray-500 hover:text-gray-600 focus:outline-none focus:text-gray-600" id="nav-toggle" type="button"><svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z" fill-rule="evenodd"></path></svg></button></div></div><div class="flex flex-col text-gray-600 capitalize lg:flex lg:px-16 lg:-mx-4 lg:flex-row lg:items-center md:hidden" id="nav-left"><a class="mt-4 lg:mt-0 lg:mx-4 hover:text-gray-900" href="/">HOME</a> <a class="mt-4 lg:mt-0 lg:mx-4 hover:text-gray-900 uppercase" href="/categories/">Categories</a> <a class="mt-4 lg:mt-0 lg:mx-4 hover:text-gray-900 uppercase" href="/tags/">Tags</a></div></div><div class="flex justify-center mt-6 lg:flex lg:mt-0 lg:-mx-2 md:hidden" id="nav-right"><a aria-label="RSS" class="mr-4 text-gray-600 hover:text-gray-400" href="/feed.xml" rel="noopener noreferrer" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 fill-current" viewBox="0 0 20 20"><path d="M5 3a1 1 0 000 2c5.523 0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"></path><path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5 1 1 0 01-1-1zM3 15a2 2 0 114 0 2 2 0 01-4 0z"></path></svg> </a><a aria-label="Github" class="mr-4 text-gray-600 hover:text-gray-400" href="https://github.com/ntsd" rel="noopener noreferrer" target="_blank"><svg class="w-7 h-7 fill-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.026 2C7.13295 1.99937 2.96183 5.54799 2.17842 10.3779C1.395 15.2079 4.23061 19.893 8.87302 21.439C9.37302 21.529 9.55202 21.222 9.55202 20.958C9.55202 20.721 9.54402 20.093 9.54102 19.258C6.76602 19.858 6.18002 17.92 6.18002 17.92C5.99733 17.317 5.60459 16.7993 5.07302 16.461C4.17302 15.842 5.14202 15.856 5.14202 15.856C5.78269 15.9438 6.34657 16.3235 6.66902 16.884C6.94195 17.3803 7.40177 17.747 7.94632 17.9026C8.49087 18.0583 9.07503 17.99 9.56902 17.713C9.61544 17.207 9.84055 16.7341 10.204 16.379C7.99002 16.128 5.66202 15.272 5.66202 11.449C5.64973 10.4602 6.01691 9.5043 6.68802 8.778C6.38437 7.91731 6.42013 6.97325 6.78802 6.138C6.78802 6.138 7.62502 5.869 9.53002 7.159C11.1639 6.71101 12.8882 6.71101 14.522 7.159C16.428 5.868 17.264 6.138 17.264 6.138C17.6336 6.97286 17.6694 7.91757 17.364 8.778C18.0376 9.50423 18.4045 10.4626 18.388 11.453C18.388 15.286 16.058 16.128 13.836 16.375C14.3153 16.8651 14.5612 17.5373 14.511 18.221C14.511 19.555 14.499 20.631 14.499 20.958C14.499 21.225 14.677 21.535 15.186 21.437C19.8265 19.8884 22.6591 15.203 21.874 10.3743C21.089 5.54565 16.9181 1.99888 12.026 2Z"></path></svg> </a><a aria-label="Linkedin" class="mr-4 text-gray-600 hover:text-gray-400" href="https://www.linkedin.com/in/ntsd" rel="noopener noreferrer" target="_blank"><svg class="w-7 h-7 fill-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 21H9V9H13V11C13.8526 9.91525 15.1456 9.26857 16.525 9.237C19.0056 9.25077 21.0072 11.2694 21 13.75V21H17V14.25C16.84 13.1326 15.8818 12.3036 14.753 12.306C14.2593 12.3216 13.7932 12.5378 13.4624 12.9046C13.1316 13.2715 12.9646 13.7573 13 14.25V21ZM7 21H3V9H7V21ZM5 7C3.89543 7 3 6.10457 3 5C3 3.89543 3.89543 3 5 3C6.10457 3 7 3.89543 7 5C7 5.53043 6.78929 6.03914 6.41421 6.41421C6.03914 6.78929 5.53043 7 5 7Z"></path></svg> </a><a aria-label="Webring" class="mr-4 text-gray-600 hover:text-gray-400" href="https://webring.wonderful.software#ntsd.dev" rel="noopener noreferrer" target="_blank"><svg class="mt-1 w-6 h-6 fill-current" fill="none" viewBox="0 0 416 416" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M53 128.8l-16-8.2a192 192 0 1094.7-88.9l7.1 16.6A174 174 0 1153 128.8z" fill-rule="evenodd" fill="currentColor"></path><path d="M94.7 92.3L82 126.5 62.6 95.7l-36.4-1.4 23.3-28-9.9-35.1 33.9 13.5 30.3-20.3-2.4 36.4L130 83.3l-35.3 9z" fill="currentColor"></path></svg></a></div></div></nav><script type="text/javascript">var navbar = document.querySelector("#navbar"); var toggle = document.querySelector("#nav-toggle"); var navLeft = document.querySelector("#nav-left"); var navRight = document.querySelector("#nav-right"); var nav = { close: function () { navLeft.classList.add("md:hidden"); navRight.classList.add("md:hidden"); toggle.classList.remove("nav-open"); }, open: function () { navLeft.classList.remove("md:hidden"); navRight.classList.remove("md:hidden"); toggle.classList.add("nav-open"); } }; toggle.addEventListener("click", function (e) { if (toggle.className.indexOf("nav-open") > 0) { nav.close(); } else { nav.open(); } }); var prevScrollPos = window.pageYOffset; window.onscroll = function () { var curScrollPos = window.pageYOffset; if (curScrollPos > navbar.offsetHeight) { if (prevScrollPos > curScrollPos) { navbar.classList.remove("lg:-translate-y-full"); } else { navbar.classList.add("lg:-translate-y-full"); } prevScrollPos = curScrollPos; } };</script><style type="text/css">header .header-bg { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2000 1500'%3E%3Cdefs%3E%3Crect stroke='%23000000' stroke-width='0.12' width='1' height='1' id='s'/%3E%3Cpattern id='a' width='3' height='3' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cuse fill='%23050505' href='%23s' y='2'/%3E%3Cuse fill='%23050505' href='%23s' x='1' y='2'/%3E%3Cuse fill='%230a0a0a' href='%23s' x='2' y='2'/%3E%3Cuse fill='%230a0a0a' href='%23s'/%3E%3Cuse fill='%230f0f0f' href='%23s' x='2'/%3E%3Cuse fill='%230f0f0f' href='%23s' x='1' y='1'/%3E%3C/pattern%3E%3Cpattern id='b' width='7' height='11' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cg fill='%23141414'%3E%3Cuse href='%23s'/%3E%3Cuse href='%23s' y='5' /%3E%3Cuse href='%23s' x='1' y='10'/%3E%3Cuse href='%23s' x='2' y='1'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='8'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='5' y='2'/%3E%3Cuse href='%23s' x='5' y='6'/%3E%3Cuse href='%23s' x='6' y='9'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='h' width='5' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cg fill='%23141414'%3E%3Cuse href='%23s' y='5'/%3E%3Cuse href='%23s' y='8'/%3E%3Cuse href='%23s' x='1' y='1'/%3E%3Cuse href='%23s' x='1' y='9'/%3E%3Cuse href='%23s' x='1' y='12'/%3E%3Cuse href='%23s' x='2'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='2'/%3E%3Cuse href='%23s' x='3' y='6'/%3E%3Cuse href='%23s' x='3' y='11'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='4' y='10'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='c' width='17' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cg fill='%231a1a1a'%3E%3Cuse href='%23s' y='11'/%3E%3Cuse href='%23s' x='2' y='9'/%3E%3Cuse href='%23s' x='5' y='12'/%3E%3Cuse href='%23s' x='9' y='4'/%3E%3Cuse href='%23s' x='12' y='1'/%3E%3Cuse href='%23s' x='16' y='6'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='d' width='19' height='17' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cg fill='%23000000'%3E%3Cuse href='%23s' y='9'/%3E%3Cuse href='%23s' x='16' y='5'/%3E%3Cuse href='%23s' x='14' y='2'/%3E%3Cuse href='%23s' x='11' y='11'/%3E%3Cuse href='%23s' x='6' y='14'/%3E%3C/g%3E%3Cg fill='%231f1f1f'%3E%3Cuse href='%23s' x='3' y='13'/%3E%3Cuse href='%23s' x='9' y='7'/%3E%3Cuse href='%23s' x='13' y='10'/%3E%3Cuse href='%23s' x='15' y='4'/%3E%3Cuse href='%23s' x='18' y='1'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='e' width='47' height='53' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cg fill='%230f0c0c'%3E%3Cuse href='%23s' x='2' y='5'/%3E%3Cuse href='%23s' x='16' y='38'/%3E%3Cuse href='%23s' x='46' y='42'/%3E%3Cuse href='%23s' x='29' y='20'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='f' width='59' height='71' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cg fill='%230f0c0c'%3E%3Cuse href='%23s' x='33' y='13'/%3E%3Cuse href='%23s' x='27' y='54'/%3E%3Cuse href='%23s' x='55' y='55'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='g' width='139' height='97' patternUnits='userSpaceOnUse' patternTransform='scale(42.85) translate(-976.66 -732.5)'%3E%3Cg fill='%230f0c0c'%3E%3Cuse href='%23s' x='11' y='8'/%3E%3Cuse href='%23s' x='51' y='13'/%3E%3Cuse href='%23s' x='17' y='73'/%3E%3Cuse href='%23s' x='99' y='57'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect fill='url(%23a)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23b)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23h)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23c)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23d)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23e)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23f)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23g)' width='100%25' height='100%25'/%3E%3C/svg%3E"); }</style><header><div class="w-full bg-center bg-cover bg-black header-bg"><div class="backdrop-filter backdrop-brightness-75"><div class="container mx-auto grid grid-cols-12"><div class="text-left text-white col-start-3 col-span-8 md:col-start-1 md:col-span-12 py-32 px-4"><span class="categories"><a class="py-1 px-2 mr-1 mb-2 inline-block border border-white hover:bg-gray-500" href="/categories/#Programming" title="Programming">Programming</a> </span><span class="tags"><a class="py-1 px-2 mr-1 mb-2 inline-block border border-white rounded-full hover:bg-gray-500" href="/tags/#Programming" title="Programming">Programming</a> <a class="py-1 px-2 mr-1 mb-2 inline-block border border-white rounded-full hover:bg-gray-500" href="/tags/#Database" title="Database">Database</a> <a class="py-1 px-2 mr-1 mb-2 inline-block border border-white rounded-full hover:bg-gray-500" href="/tags/#PostgreSQL" title="PostgreSQL">PostgreSQL</a> <a class="py-1 px-2 mr-1 mb-2 inline-block border border-white rounded-full hover:bg-gray-500" href="/tags/#Performance" title="Performance">Performance</a> <a class="py-1 px-2 mr-1 mb-2 inline-block border border-white rounded-full hover:bg-gray-500" href="/tags/#Backend" title="Backend">Backend</a></span><h1 class="text-6xl my-4">Explain index types in PostgreSQL</h1><h2 class="text-2xl my-4">Explain index types in PostgreSQL how it work and compare between Hash and B-Tree index</h2><span class="meta">Posted by ntsd on <time datetime="2021-07-10">July 10, 2021</time></span></div></div></div></div></header><article class="container mx-auto grid grid-cols-12"><div class="col-start-3 col-span-8 md:col-start-1 md:col-span-12 p-4"><div class="py-8"><div class="post-container prose max-w-none"><p>Postgres provides many index types such as B-tree, hash, GiST, and GIN. This article is about commons indexes like B-Tree and Hash to tell what is difference and which one should use for the situation. GiST and GIN are indexes for supporting Full-Text Search which I’ll explain in the new blog post.</p><h2 id="hash-index">Hash index<a class="anchorjs-link" aria-label="Anchor" data-anchorjs-icon="" href="#hash-index" style="opacity: 1; padding-left: 0.375em;"></a></h2><p>Hash index is probably the fastest and the simplest index with O(1) the data will store in hashmap structure. for example when you query and the key index hit the hash map will return address to data storage is instantly. Hash index in Postgres doesn’t support composite or multi-columns index and Hash index don’t have ability for ordering or select between range, Unlike B-tree index it can do the job.</p><h3 id="examples">Examples<a class="anchorjs-link" aria-label="Anchor" data-anchorjs-icon="" href="#examples" style="opacity: 1; padding-left: 0.375em;"></a></h3><p>Prepare schema and Create an Hash indexes for first_name and last_name.</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> persons <span class="token punctuation">(</span>
  id <span class="token keyword">int</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  first_name <span class="token keyword">text</span><span class="token punctuation">,</span>
  last_name <span class="token keyword">text</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> first_name_idx <span class="token keyword">ON</span> persons <span class="token keyword">USING</span> <span class="token keyword">hash</span> <span class="token punctuation">(</span>first_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> last_name_idx <span class="token keyword">ON</span> persons <span class="token keyword">USING</span> <span class="token keyword">hash</span> <span class="token punctuation">(</span>last_name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> persons <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'john'</span><span class="token punctuation">,</span> <span class="token string">'doe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> persons <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'jane'</span><span class="token punctuation">,</span> <span class="token string">'doe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> persons <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'jack'</span><span class="token punctuation">,</span> <span class="token string">'doe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> persons <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'john'</span><span class="token punctuation">,</span> <span class="token string">'connor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>persons table</p><table><thead><tr><th>id (PK)</th><th>first_name</th><th>last_name</th></tr></thead><tbody><tr><td>1</td><td>john</td><td>doe</td></tr><tr><td>2</td><td>jane</td><td>doe</td></tr><tr><td>3</td><td>jack</td><td>doe</td></tr><tr><td>4</td><td>john</td><td>connor</td></tr></tbody></table><p>Example 1. When query by column</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> persons <span class="token keyword">WHERE</span> last_name<span class="token operator">=</span><span class="token string">'doe'</span><span class="token punctuation">;</span>
</code></pre><p>The query will hit <code class="highlighter-rouge language-plaintext">last_name_idx</code> index and the index will return all addresses to all rows which last_name is ‘doe’ instantly.</p><p><img alt="hash query by column" src="/img/in-post/2021-7-10-postgresql-index-types/hash-query-1.png" loading="lazy"></p><p>Example 2. When query by multi columns</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> persons <span class="token keyword">WHERE</span> first_name<span class="token operator">=</span><span class="token string">'john'</span> <span class="token operator">AND</span> last_name<span class="token operator">=</span><span class="token string">'doe'</span><span class="token punctuation">;</span>
</code></pre><p>The query will using <code class="highlighter-rouge language-plaintext">first_name_idx</code> index and <code class="highlighter-rouge language-plaintext">last_name_idx</code> index. I have no idea why it checks <code class="highlighter-rouge language-plaintext">last_name_idx</code> first. I tried to swap where condition but the plan still the same.</p><p><img alt="hash query by multi columns" src="/img/in-post/2021-7-10-postgresql-index-types/hash-query-2.png" loading="lazy"></p><h2 id="b-tree-index">B-Tree index<a class="anchorjs-link" aria-label="Anchor" data-anchorjs-icon="" href="#b-tree-index" style="opacity: 1; padding-left: 0.375em;"></a></h2><p>B-tree index will store data in tree structure that allow for sorted, search, and sequence data in O(log n). B-tree structure is not like normal binary search tree, a node can have more than one key and more than two children. That’s why B-tree is suit for database because allow more complexity in search condition.</p><h3 id="examples-1">Examples<a class="anchorjs-link" aria-label="Anchor" data-anchorjs-icon="" href="#examples-1" style="opacity: 1; padding-left: 0.375em;"></a></h3><p>Prepare schema and Create an B-Tree indexes for salary and multi columns index with age and salary.</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employees <span class="token punctuation">(</span>
  id <span class="token keyword">int</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  name <span class="token keyword">text</span><span class="token punctuation">,</span>
  salary <span class="token keyword">int</span><span class="token punctuation">,</span>
  age <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> salary_idx <span class="token keyword">ON</span> employees <span class="token keyword">USING</span> <span class="token keyword">btree</span> <span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> age_salary_idx <span class="token keyword">ON</span> employees <span class="token keyword">USING</span> <span class="token keyword">btree</span> <span class="token punctuation">(</span>age<span class="token punctuation">,</span> salary<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'john'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'jane'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'jack'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'jill'</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>employees table</p><table><thead><tr><th>id (PK)</th><th>name</th><th>salary</th><th>age</th></tr></thead><tbody><tr><td>1</td><td>john</td><td>3000</td><td>25</td></tr><tr><td>2</td><td>jane</td><td>1000</td><td>25</td></tr><tr><td>3</td><td>jack</td><td>2000</td><td>40</td></tr><tr><td>3</td><td>jill</td><td>5000</td><td>25</td></tr></tbody></table><p>Example 1. When query all ordering by index</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> salary<span class="token punctuation">;</span>
</code></pre><p>the query will using index <code class="highlighter-rouge language-plaintext">salary_idx</code> to order all employees.</p><p><img alt="B-Tree query all ordering by index" src="/img/in-post/2021-7-10-postgresql-index-types/btree-query-1.png" loading="lazy"></p><p>Example 2. When query all ordering by composite index</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age<span class="token punctuation">;</span>
</code></pre><p>the query will use index <code class="highlighter-rouge language-plaintext">age_salary_idx</code> to order all employees. This proves that the multi-columns index can also order by one field.</p><p><img alt="B-Tree query all ordering by composite index" src="/img/in-post/2021-7-10-postgresql-index-types/btree-query-2.png" loading="lazy"></p><p>Example 3. When query by a column using index</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> salary <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
</code></pre><p>As the query plan after the index hit still needs to bitmap Heap scan after and it took 4.20..13.67 cost which means startup cost is 4.2 and the total cost is 13.67. that is why the b-tree index is not O(1).</p><p><img alt="B-Tree query by a column using index" src="/img/in-post/2021-7-10-postgresql-index-types/btree-query-3.png" loading="lazy"></p><p>Example 4. When query by multiple column using composite index</p><pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> age <span class="token operator">=</span> <span class="token number">25</span> <span class="token operator">AND</span> salary <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
</code></pre><p>This is a bit surprising. when query exactly multi-columns to the composite index after it hit the index it will return the result instantly. This is probably O(1) in this situation.</p><p><img alt="B-Tree query by multiple column using composite index" src="/img/in-post/2021-7-10-postgresql-index-types/btree-query-4.png" loading="lazy"></p><h2 id="conclusion">Conclusion<a class="anchorjs-link" aria-label="Anchor" data-anchorjs-icon="" href="#conclusion" style="opacity: 1; padding-left: 0.375em;"></a></h2><p>The key point is to create an index base on the queries you are using. B-tree for ordering query and hash for non-ordering. You can create many indexes as you want to improve the read performance. The disk space or the block size might not a big deal nowadays. Once a query doesn’t hit any index and it’s often used, you should consider how to indexing it.</p><h2 id="reference">Reference<a class="anchorjs-link" aria-label="Anchor" data-anchorjs-icon="" href="#reference" style="opacity: 1; padding-left: 0.375em;"></a></h2><p><a href="https://www.postgresql.org/docs/current/indexes-types.html">https://www.postgresql.org/docs/current/indexes-types.html</a></p><p><a href="http://itdoc.hitachi.co.jp/manuals/3020/3020635200e/W3520279.HTM">http://itdoc.hitachi.co.jp/manuals/3020/3020635200e/W3520279.HTM</a></p><p><a href="https://user3141592.medium.com/single-vs-composite-indexes-in-relational-databases-58d0eb045cbe">https://user3141592.medium.com/single-vs-composite-indexes-in-relational-databases-58d0eb045cbe</a></p></div><ul class="grid grid-cols-2 text-center mt-8"><li class="col-span-1 border p-4 mr-4 hover:bg-gray-300"><a href="/speed-testing-free-static-web-hosting/" data-toggle="tooltip" data-placement="top" title="Speed testing and compare free static web hosting (Netlify vs Github Page vs Fast.io)"><div class="text-xl font-bold">Previous</div><div class="text-gray-600">Speed testing and compare free static web hosting (Netlify vs Github Page vs Fast.io)</div></a></li><li class="col-span-1 border p-4 ml-4 hover:bg-gray-300"><a href="/reduce-runtime-javascript-using-puppeeteer/" data-toggle="tooltip" data-placement="top" title="Reduce runtime JavaScript to improve page speed using Puppeteer"><div class="text-xl font-bold">Next</div><div class="text-gray-600">Reduce runtime JavaScript to improve page speed using Puppeteer</div></a></li></ul></div><div class="comment giscus py-8"></div><div class="pt-8"><a class="text-gray-700 font-bond" href="/tags/">FEATURED TAGS</a><div class="my-4 text-xs"><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Artificial%20Intelligence" title="Artificial Intelligence" rel="1">Artificial Intelligence </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Programming" title="Programming" rel="8">Programming </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Python" title="Python" rel="2">Python </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Code%20golf" title="Code golf" rel="1">Code golf </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#C++" title="C++" rel="1">C++ </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#aria2" title="aria2" rel="1">aria2 </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Network" title="Network" rel="3">Network </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#OpenWRT" title="OpenWRT" rel="1">OpenWRT </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Router" title="Router" rel="1">Router </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Embedded" title="Embedded" rel="1">Embedded </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Gatsby" title="Gatsby" rel="1">Gatsby </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#React" title="React" rel="1">React </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#GraphQL" title="GraphQL" rel="1">GraphQL </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Progressive%20Web%20App" title="Progressive Web App" rel="1">Progressive Web App </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#TypeScript" title="TypeScript" rel="2">TypeScript </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Frontend" title="Frontend" rel="5">Frontend </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Facebook%20Developer" title="Facebook Developer" rel="1">Facebook Developer </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#ESLint" title="ESLint" rel="1">ESLint </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Hosting" title="Hosting" rel="1">Hosting </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Website" title="Website" rel="1">Website </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Web%20Performance" title="Web Performance" rel="2">Web Performance </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Database" title="Database" rel="1">Database </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#PostgreSQL" title="PostgreSQL" rel="1">PostgreSQL </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Performance" title="Performance" rel="1">Performance </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Backend" title="Backend" rel="1">Backend </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Web%20Development" title="Web Development" rel="1">Web Development </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Git" title="Git" rel="1">Git </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Security" title="Security" rel="1">Security </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Kubernetes" title="Kubernetes" rel="1">Kubernetes </a><a class="py-1 px-2 mr-1 mb-2 inline-block border border-black rounded-full hover:bg-gray-300" href="/tags/#Google%20Cloud%20Platform" title="Google Cloud Platform" rel="1">Google Cloud Platform</a></div></div></div><div class="col-span-2 md:hidden p-4"><div class="on-page-nav sticky top-28 text-gray-500 font-medium py-8"><div class="text-gray-900 tracking-wide font-semibold mb-3 text-sm">ON THIS PAGE</div></div></div></article><script type="text/javascript">async( "https://cdn.jsdelivr.net/npm/scrollnav@3.0.1/dist/scrollnav.min.umd.js", function () { const content = document.querySelector('.post-container'); const insertTarget = document.querySelector('.on-page-nav'); scrollnav.init(content, { debug: false, insertTarget: insertTarget, insertLocation: 'append', }); }, 2000, false );</script><style>nav.scroll-nav a.scroll-nav__link { display: block; padding-top: 0.5rem; padding-bottom: 0.5rem; } nav.scroll-nav li.scroll-nav__item.scroll-nav__item--active { color: #000; } nav.scroll-nav a.scroll-nav__link:hover { color: #000; }</style><script type="text/javascript">setTimeout(function () { var d = document, s = d.createElement("script"); s.src = " https://giscus.app/client.js"; s.setAttribute("data-repo", "ntsd/ntsd.github.io"); s.setAttribute("data-repo-id", "MDEwOlJlcG9zaXRvcnkyNDYwNjU3MDI"); s.setAttribute("data-category", "General"); s.setAttribute("data-category-id", "DIC_kwDODqqqJs4B_e5q"); s.setAttribute("data-mapping", "pathname"); s.setAttribute("data-reactions-enabled", "0"); s.setAttribute("data-emit-metadata", "0"); s.setAttribute("data-theme", "light"); s.setAttribute("crossorigin", "anonymous"); (d.head || d.body).appendChild(s); }, 4000);</script><style>.anchorjs-link { color: #777 !important; text-decoration: none !important; } .anchorjs-link:hover { color: #000 !important; } .anchorjs-link::before { content: "#"; }</style><footer><hr class="mt-10 dark:border-gray-500"><div class="container px-6 py-8 mx-auto"><div class="grid justify-items-center"><div class="flex justify-center my-4"><a aria-label="RSS" class="mr-4 text-gray-600 hover:text-gray-400" href="/feed.xml" rel="noopener noreferrer" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 fill-current" viewBox="0 0 20 20"><path d="M5 3a1 1 0 000 2c5.523 0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"></path><path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5 1 1 0 01-1-1zM3 15a2 2 0 114 0 2 2 0 01-4 0z"></path></svg> </a><a aria-label="Github" class="mr-4 text-gray-600 hover:text-gray-400" href="https://github.com/ntsd" rel="noopener noreferrer" target="_blank"><svg class="w-7 h-7 fill-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.026 2C7.13295 1.99937 2.96183 5.54799 2.17842 10.3779C1.395 15.2079 4.23061 19.893 8.87302 21.439C9.37302 21.529 9.55202 21.222 9.55202 20.958C9.55202 20.721 9.54402 20.093 9.54102 19.258C6.76602 19.858 6.18002 17.92 6.18002 17.92C5.99733 17.317 5.60459 16.7993 5.07302 16.461C4.17302 15.842 5.14202 15.856 5.14202 15.856C5.78269 15.9438 6.34657 16.3235 6.66902 16.884C6.94195 17.3803 7.40177 17.747 7.94632 17.9026C8.49087 18.0583 9.07503 17.99 9.56902 17.713C9.61544 17.207 9.84055 16.7341 10.204 16.379C7.99002 16.128 5.66202 15.272 5.66202 11.449C5.64973 10.4602 6.01691 9.5043 6.68802 8.778C6.38437 7.91731 6.42013 6.97325 6.78802 6.138C6.78802 6.138 7.62502 5.869 9.53002 7.159C11.1639 6.71101 12.8882 6.71101 14.522 7.159C16.428 5.868 17.264 6.138 17.264 6.138C17.6336 6.97286 17.6694 7.91757 17.364 8.778C18.0376 9.50423 18.4045 10.4626 18.388 11.453C18.388 15.286 16.058 16.128 13.836 16.375C14.3153 16.8651 14.5612 17.5373 14.511 18.221C14.511 19.555 14.499 20.631 14.499 20.958C14.499 21.225 14.677 21.535 15.186 21.437C19.8265 19.8884 22.6591 15.203 21.874 10.3743C21.089 5.54565 16.9181 1.99888 12.026 2Z"></path></svg> </a><a aria-label="Linkedin" class="mr-4 text-gray-600 hover:text-gray-400" href="https://www.linkedin.com/in/ntsd" rel="noopener noreferrer" target="_blank"><svg class="w-7 h-7 fill-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 21H9V9H13V11C13.8526 9.91525 15.1456 9.26857 16.525 9.237C19.0056 9.25077 21.0072 11.2694 21 13.75V21H17V14.25C16.84 13.1326 15.8818 12.3036 14.753 12.306C14.2593 12.3216 13.7932 12.5378 13.4624 12.9046C13.1316 13.2715 12.9646 13.7573 13 14.25V21ZM7 21H3V9H7V21ZM5 7C3.89543 7 3 6.10457 3 5C3 3.89543 3.89543 3 5 3C6.10457 3 7 3.89543 7 5C7 5.53043 6.78929 6.03914 6.41421 6.41421C6.03914 6.78929 5.53043 7 5 7Z"></path></svg> </a><a aria-label="Webring" class="mr-4 text-gray-600 hover:text-gray-400" href="https://webring.wonderful.software#ntsd.dev" rel="noopener noreferrer" target="_blank"><svg class="mt-1 w-6 h-6 fill-current" fill="none" viewBox="0 0 416 416" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M53 128.8l-16-8.2a192 192 0 1094.7-88.9l7.1 16.6A174 174 0 1153 128.8z" fill-rule="evenodd" fill="currentColor"></path><path d="M94.7 92.3L82 126.5 62.6 95.7l-36.4-1.4 23.3-28-9.9-35.1 33.9 13.5 30.3-20.3-2.4 36.4L130 83.3l-35.3 9z" fill="currentColor"></path></svg></a></div><div class="text-center text-gray-800"><div>© Jirawat Boonkumnerd 2022</div><div>Made by <a class="text-gray-600" href="https://ntsd.dev">ntsd</a></div></div></div></div></footer><script type="text/javascript" async="">if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/sw.js').catch((err) => { console.error("service worker register error:", err); }); navigator.serviceWorker.onmessage = (e) => { const data = e.data; if(data.command == "UPDATE_FOUND"){ console.log("UPDATE_FOUND_BY_SW", data); location.reload(); } }; }</script></body></html>